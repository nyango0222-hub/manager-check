<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#F5F0E8">
<title>新津店ルーティン業務</title>
<style>
/* ========================================
   リセット・基本設定
======================================== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
background: #FAF9F6;
min-height: 100vh;
color: #1a1a1a;
line-height: 1.6;
padding-bottom: env(safe-area-inset-bottom);
}

.container {
max-width: 600px;
margin: 0 auto;
padding: 0 20px 120px;
}

header {
padding: 48px 20px 24px;
text-align: center;
}

header h1 {
font-size: 1.75rem;
font-weight: 600;
background: linear-gradient(135deg, #B8860B 0%, #DAA520 50%, #B8860B 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
margin-bottom: 4px;
}

.version {
font-size: 0.7rem;
color: #9b9b9b;
letter-spacing: 0.1em;
}

.date-display {
font-size: 0.9rem;
color: #6b6b6b;
margin-top: 4px;
}

/* シフト選択 */
.shift-select-screen { padding: 40px 0; }
.shift-buttons { display: flex; flex-direction: column; gap: 12px; }
.shift-btn {
padding: 20px 24px;
background: #fff;
border: 1px solid #E5E2DC;
border-radius: 12px;
font-size: 1rem;
font-weight: 500;
cursor: pointer;
text-align: left;
display: flex;
justify-content: space-between;
align-items: center;
}
.shift-btn:active { transform: scale(0.98); background: #F5F0E8; }
.shift-btn .time { font-size: 0.85rem; color: #6b6b6b; font-weight: 400; }

/* メイン画面 */
.main-screen { display: none; }
.main-screen.active { display: block; }
.shift-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid #E5E2DC; }
.current-shift { font-size: 1.2rem; font-weight: 600; }
.change-btn { padding: 8px 16px; background: transparent; border: 1px solid #D4CFC5; border-radius: 8px; font-size: 0.85rem; color: #6b6b6b; }

/* プログレスバー */
.progress-section { margin-bottom: 24px; background: #fff; padding: 15px; border-radius: 12px; border: 1px solid #E5E2DC; }
.progress-bar { height: 6px; background: #E8E4DB; border-radius: 3px; overflow: hidden; margin-bottom: 8px; }
.progress-fill { height: 100%; background: linear-gradient(90deg, #B8860B, #DAA520); transition: width 0.3s ease; }
.progress-text { font-size: 0.85rem; color: #6b6b6b; text-align: right; font-weight: 600; }

/* チェックリスト */
.checklist { display: flex; flex-direction: column; gap: 8px; }
.checklist-item { display: flex; align-items: center; padding: 16px; background: #fff; border: 1px solid #E5E2DC; border-radius: 10px; gap: 12px; user-select: none; }
.checklist-item.checked { background: #F5F0E8; border-color: #D4CFC5; }
.checklist-item.checked .item-text { color: #8B7355; text-decoration: line-through; }
.custom-checkbox { position: relative; width: 24px; height: 24px; flex-shrink: 0; }
.custom-checkbox input { position: absolute; opacity: 0; width: 100%; height: 100%; z-index: 2; margin: 0; }
.checkmark { position: absolute; top: 0; left: 0; width: 24px; height: 24px; background: #fff; border: 2px solid #D4CFC5; border-radius: 6px; }
.custom-checkbox input:checked + .checkmark { background: #B8860B; border-color: #B8860B; }
.custom-checkbox input:checked + .checkmark::after { content: ''; position: absolute; left: 7px; top: 3px; width: 6px; height: 11px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg); }

/* ナビゲーション */
.nav-tabs { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; border-top: 1px solid #E5E2DC; display: flex; justify-content: space-around; padding: 12px 0; z-index: 100; padding-bottom: calc(12px + env(safe-area-inset-bottom)); }
.tab { padding: 8px 20px; background: transparent; border: none; font-size: 0.9rem; color: #9b9b9b; border-radius: 8px; }
.tab.active { background: #F5F0E8; color: #B8860B; font-weight: 600; }
.panel { display: none; }
.panel.active { display: block; }

/* 編集画面 */
.edit-shift-tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
.edit-shift-tab { padding: 8px 16px; background: #fff; border: 1px solid #E5E2DC; border-radius: 8px; font-size: 0.85rem; color: #6b6b6b; }
.edit-shift-tab.active { background: #B8860B; color: #fff; border-color: #B8860B; }
.add-item-section { background: #fff; border: 1px solid #E5E2DC; border-radius: 12px; padding: 16px; margin-bottom: 20px; }
.add-item-section input[type="text"] { width: 100%; padding: 12px; border: 1px solid #E5E2DC; border-radius: 8px; font-size: 16px; margin-bottom: 12px; }
.day-select { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
.day-select label { display: flex; align-items: center; gap: 4px; padding: 6px 12px; background: #F5F0E8; border-radius: 6px; font-size: 0.85rem; }
.day-select input { display: none; }
.day-select input:checked + span { color: #B8860B; font-weight: 600; }
.add-btn { width: 100%; padding: 12px; background: #B8860B; color: #fff; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 500; }
.edit-list-item { background: #fff; border: 1px solid #E5E2DC; border-radius: 10px; padding: 15px; margin-bottom: 10px; }
.edit-item-bottom { display: flex; gap: 8px; margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee; }
.delete-btn { color: #C53030; background: #FEE; border: none; padding: 8px 12px; border-radius: 6px; font-size: 0.8rem; }
.complete-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #B8860B, #DAA520); color: #fff; border: none; border-radius: 12px; font-size: 1rem; font-weight: 600; margin-top: 20px; }
.complete-btn:disabled { background: #E8E4DB; color: #9b9b9b; }

/* 完了メッセージ */
.completion-message { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #FAF9F6; z-index: 300; justify-content: center; align-items: center; flex-direction: column; }
.completion-message.show { display: flex; }

/* モーダル */
.modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 200; align-items: center; justify-content: center; padding: 20px; }
.modal-overlay.show { display: flex; }
.modal { background: #fff; border-radius: 16px; padding: 24px; width: 100%; max-width: 400px; }
</style>
</head>
<body>

<header>
  <h1>新津店ルーティン業務</h1>
  <div class="version">ver 2026.01.26.3</div>
  <div class="date-display" id="dateDisplay"></div>
</header>

<div class="container">
  <div id="shiftSelectScreen" class="shift-select-screen">
    <h2 style="text-align:center; margin-bottom:24px; font-size:1.1rem;">シフトを選択してください</h2>
    <div class="shift-buttons">
      <button class="shift-btn" data-shift="超早"><span>超早</span><span class="time">7:00 - 16:00</span></button>
      <button class="shift-btn" data-shift="早番"><span>早番</span><span class="time">9:00 - 18:00</span></button>
      <button class="shift-btn" data-shift="中番"><span>中番</span><span class="time">11:00 - 20:00</span></button>
      <button class="shift-btn" data-shift="遅番"><span>遅番</span><span class="time">14:30 - 23:30</span></button>
    </div>
  </div>

  <div id="mainScreen" class="main-screen">
    <div class="nav-tabs">
      <button class="tab active" data-tab="check">チェック</button>
      <button class="tab" data-tab="edit">項目編集</button>
      <button class="tab" data-tab="history">履歴</button>
    </div>

    <div id="checkPanel" class="panel active">
      <div class="shift-header">
        <span class="current-shift" id="currentShiftName"></span>
        <button class="change-btn" id="changeShiftBtn">変更</button>
      </div>
      <div class="progress-section" id="progressSection">
        <div class="progress-bar"><div id="progressFill" class="progress-fill" style="width:0%"></div></div>
        <div id="progressText" class="progress-text">0/0</div>
      </div>
      <div id="checklist" class="checklist"></div>
      <button id="completeBtn" class="complete-btn" disabled>完了</button>
    </div>

    <div id="editPanel" class="panel">
      <div id="editShiftTabs" class="edit-shift-tabs"></div>
      <div class="add-item-section">
        <input type="text" id="newItemText" placeholder="新しい項目を入力...">
        <div class="day-select" id="newItemDays">
          <label><input type="checkbox" value="毎日" checked><span>毎日</span></label>
          <label><input type="checkbox" value="月"><span>月</span></label>
          <label><input type="checkbox" value="火"><span>火</span></label>
          <label><input type="checkbox" value="水"><span>水</span></label>
          <label><input type="checkbox" value="木"><span>木</span></label>
          <label><input type="checkbox" value="金"><span>金</span></label>
          <label><input type="checkbox" value="土"><span>土</span></label>
          <label><input type="checkbox" value="日"><span>日</span></label>
        </div>
        <button class="add-btn" id="addItemBtn">追加</button>
      </div>
      <ul id="editList" class="edit-list"></ul>
    </div>

    <div id="historyPanel" class="panel">
      <div id="historyList"></div>
    </div>
  </div>
</div>

<div id="completionMessage" class="completion-message">
  <div style="font-size:64px;">✓</div>
  <h2>完了しました</h2>
  <p>お疲れ様でした</p>
</div>

<script>
(function() {
  'use strict';

  var STORAGE_KEYS = {
    items: 'niitsu_routine_items_v5',
    todayChecks: 'niitsu_routine_checks_v5',
    currentShift: 'niitsu_routine_shift_v5',
    history: 'niitsu_routine_hist_v5'
  };

  var state = {
    items: JSON.parse(localStorage.getItem(STORAGE_KEYS.items)) || {
      '超早': [{id:1, text:'社員①7:00朝礼', days:['毎日']}],
      '早番': [{id:2, text:'知久屋売上確認', days:['毎日']}],
      '中番': [],
      '遅番': [{id:3, text:'レジ締め・売上回収', days:['毎日']}]
    },
    todayChecks: JSON.parse(localStorage.getItem(STORAGE_KEYS.todayChecks)) || {},
    currentShift: localStorage.getItem(STORAGE_KEYS.currentShift) || null
  };

  function init() {
    document.getElementById('dateDisplay').textContent = new Date().toLocaleDateString('ja-JP', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
    setupEventListeners();
    if (state.currentShift) {
      showMainScreen(state.currentShift);
    }
    renderChecklist();
  }

  function setupEventListeners() {
    document.querySelectorAll('.shift-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        state.currentShift = btn.dataset.shift;
        localStorage.setItem(STORAGE_KEYS.currentShift, state.currentShift);
        showMainScreen(state.currentShift);
      });
    });

    document.getElementById('changeShiftBtn').addEventListener('click', () => {
      document.getElementById('mainScreen').classList.remove('active');
      document.getElementById('shiftSelectScreen').style.display = 'block';
    });

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab + 'Panel').classList.add('active');
        if(tab.dataset.tab === 'edit') renderEditList();
      });
    });

    document.getElementById('completeBtn').addEventListener('click', () => {
      document.getElementById('completionMessage').classList.add('show');
      setTimeout(() => {
        document.getElementById('completionMessage').classList.remove('show');
      }, 2000);
    });
  }

  function showMainScreen(shift) {
    document.getElementById('currentShiftName').textContent = shift;
    document.getElementById('shiftSelectScreen').style.display = 'none';
    document.getElementById('mainScreen').classList.add('active');
    renderChecklist();
  }

  function renderChecklist() {
    const container = document.getElementById('checklist');
    container.innerHTML = '';
    const items = state.items[state.currentShift] || [];
    
    items.forEach(item => {
      const div = document.createElement('div');
      div.className = 'checklist-item' + (state.todayChecks[item.id] ? ' checked' : '');
      div.innerHTML = `
        <div class="custom-checkbox">
          <input type="checkbox" ${state.todayChecks[item.id] ? 'checked' : ''} data-id="${item.id}">
          <span class="checkmark"></span>
        </div>
        <span class="item-text">${item.text}</span>
      `;
      div.addEventListener('click', () => {
        state.todayChecks[item.id] = !state.todayChecks[item.id];
        localStorage.setItem(STORAGE_KEYS.todayChecks, JSON.stringify(state.todayChecks));
        renderChecklist();
        updateProgress();
      });
      container.appendChild(div);
    });
    updateProgress();
  }

  function updateProgress() {
    const items = state.items[state.currentShift] || [];
    const checked = items.filter(item => state.todayChecks[item.id]).length;
    const percent = items.length > 0 ? (checked / items.length) * 100 : 0;
    document.getElementById('progressFill').style.width = percent + '%';
    document.getElementById('progressText').textContent = checked + '/' + items.length;
    document.getElementById('completeBtn').disabled = checked === 0 || checked !== items.length;
  }

  function renderEditList() {
    const container = document.getElementById('editList');
    container.innerHTML = '';
    const items = state.items[state.currentShift] || [];
    items.forEach((item, index) => {
      const li = document.createElement('li');
      li.className = 'edit-list-item';
      li.innerHTML = `
        <div>${item.text}</div>
        <div class="edit-item-bottom">
          <button class="delete-btn" onclick="deleteItem(${index})">削除</button>
        </div>
      `;
      container.appendChild(li);
    });
  }

  window.deleteItem = function(index) {
    state.items[state.currentShift].splice(index, 1);
    localStorage.setItem(STORAGE_KEYS.items, JSON.stringify(state.items));
    renderEditList();
    renderChecklist();
  };

  init();
})();
</script>
</body>
</html>
